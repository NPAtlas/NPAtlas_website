<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>Mailer test</title>
</head>
<body style="background-color:lightblue;">
  <div id="clustersform_div" >
    <form id="clustersform"class="" action="#" method="get">
      <input type="radio" name="correctionType" checked="checked" value="missingCompound"/>
    	<label>Missing compound</label>
      <br>
      <input type="radio" name="correctionType" value="incorrectStructure"/>
    	<label>Incorrect structure</label>
      <br>
      <input type="radio" name="correctionType" value="incorrectCompName"/>
      <label>Incorrect compound name</label>
      <br>
      <input type="radio" name="correctionType" value="incorrectRefer" />
    	<label>Incorrect original isolation reference</label>
      <br>
      <input type="radio" name="correctionType" value="incorrectTax"/>
    	<label>Incorrect original isolation taxonomy</label>
      <br>
      <input id="NPAinput" type="text" placeholder='NPA123456'/>
      <br>
      <input id="NPAname" type="text" placeholder='name'/>
      <br>
      <input id="NPAemail" type="text" placeholder='email'/>
      <br>
      <input type="submit" id="NPAsubmit" name="submit" value="Send it !">
    </form>
  </div>
</body>
<script type="text/javascript">
// ====================================================================================
// ====================================================================================
// event listener
var cform = document.getElementById('clustersform_div');
if (cform.attachEvent) {
  cform.attachEvent("submit", process_form);
} else {
  cform.addEventListener("submit", process_form);
}

// ====================================================================================
// ====================================================================================
// form processor
function process_form(e)
{

  if (e.preventDefault) e.preventDefault();//safety

  // get form data
  //var form_data= objectifyForm('clustersform');


  var form_npaid=document.getElementById('NPAinput').value;

  var form_name=document.getElementById('NPAname').value;

  var form_email=document.getElementById('NPAemail').value;

  var form_corr;
  var form_rad=document.getElementsByName('correctionType');
  // console.log("rad: ",form_rad);
  for (var i =0; i<form_rad.length; i++)
  {
    if (form_rad[i].checked == true)
    {
      form_corr=form_rad[i].value;
      break;
    }
  }

  console.log("npaid:",form_npaid);
  console.log("name:",form_name);
  console.log("corr:",form_corr);
  // var correctionsData = JSON.stringify({
  //                       correctionTypeRadio : form_corr,
  //                       npaid : form_npaid,
  //                       correctCitation : "correctCitation",
  //                       compoundStructure : "compoundStructure",
  //                       correctGenus : "correctGenus",
  //                       correctCompName : "correctCompName",
  //                       inCorrectCompoundName : "inCorrectCompoundName",
  //                       compoundName : "compoundName",
  //                       compoundFormula : "compoundFormula",
  //                       otherInfo : "otherInfo",
  //                       correctTaxRadio : "correctTaxRadio",
  //                       correctReferRadio : "correctReferRadio",
  //                       correctCompNameRadio : "correctCompNameRadio",
  //                       missingCmpXML :"\n  MJ172000                      \n\n  6  6  0  0  0  0  0  0  0  0999 V2000\n   -0.8705    3.9500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.5849    3.5375    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.5849    2.7124    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.8705    2.2999    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1560    2.7124    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1560    3.5375    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  1  1  0  0  0  0\nM  END\n"
  //                       //"<img alt=''  src='data:image/png;base64,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'>"
  //                       ,
  //                       incorrStrctXML : "incorrStrctXML"
  //                    });


var picture_params={
  "structure": ""  ,
  "parameters": "png:w200,h200,b32"
};
console.log(picture_params);

if(picture_params.structure !="")
{
  console.log("structure");
  var xhr_picture = new XMLHttpRequest();
  xhr_picture.onreadystatechange = function()
  {
    if(xhr_picture.readyState == 4 && xhr_picture.status == 200)
    {
      var resp=JSON.parse(xhr_picture.responseText);
      console.log('resp:',resp);
      var structurePicture = resp['binaryStructure']
      var correctionsData = JSON.stringify({
                            correctionTypeRadio : form_corr,
                            npaid : form_npaid,
                            correctCitation : "correctCitation",
                            compoundStructure : "compoundStructure",
                            correctGenus : "correctGenus",
                            correctCompName : "correctCompName",
                            inCorrectCompoundName : "inCorrectCompoundName",
                            compoundName : "compoundName",
                            compoundFormula : "compoundFormula",
                            otherInfo : "otherInfo",
                            correctTaxRadio : "correctTaxRadio",
                            correctReferRadio : "correctReferRadio",
                            correctCompNameRadio : "correctCompNameRadio",
                            missingCmpXML :"\n  MJ172000                      \n\n  6  6  0  0  0  0  0  0  0  0999 V2000\n   -0.8705    3.9500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.5849    3.5375    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.5849    2.7124    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.8705    2.2999    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1560    2.7124    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1560    3.5375    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  1  1  0  0  0  0\nM  END\n",
                            incorrStrctXML : "incorrStrctXML"
                         });
    // send th email
    var xhr_mail = new XMLHttpRequest();
    xhr_mail.onreadystatechange = function()
    {
      if(xhr_mail.readyState == 4 && xhr_mail.status == 200)
      {
        var message=xhr_mail.responseText;
        console.log(message);
      }
    }
    xhr_mail.open('POST','/custom/corrections/php/sendMailPost.php',true);
  	xhr_mail.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  	xhr_mail.send(JSON.stringify({"correctionsJSON":correctionsData,"userName":form_name,'userEmail':form_email,'structurePicture':structurePicture}));
    // console.log({"name":form_name,'email':form_email});
    // console.log('data:',JSON.parse(correctionsData));
    }
  }
  xhr_picture.open('POST','http://npatlas-dev.chem.sfu.ca:8080/webservices2/rest-v0/util/calculate/molExport',true);
  xhr_picture.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr_picture.send(JSON.stringify(picture_params));
} else {

    var correctionsData = JSON.stringify({
                          correctionTypeRadio : form_corr,
                          npaid : form_npaid,
                          correctCitation : "correctCitation",
                          compoundStructure : "compoundStructure",
                          correctGenus : "correctGenus",
                          correctCompName : "correctCompName",
                          inCorrectCompoundName : "inCorrectCompoundName",
                          compoundName : "compoundName",
                          compoundFormula : "compoundFormula",
                          otherInfo : "otherInfo",
                          correctTaxRadio : "correctTaxRadio",
                          correctReferRadio : "correctReferRadio",
                          correctCompNameRadio : "correctCompNameRadio",
                          missingCmpXML :"\n  MJ172000                      \n\n  6  6  0  0  0  0  0  0  0  0999 V2000\n   -0.8705    3.9500    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.5849    3.5375    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -1.5849    2.7124    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.8705    2.2999    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1560    2.7124    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n   -0.1560    3.5375    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0\n  1  2  2  0  0  0  0\n  2  3  1  0  0  0  0\n  3  4  2  0  0  0  0\n  4  5  1  0  0  0  0\n  5  6  2  0  0  0  0\n  6  1  1  0  0  0  0\nM  END\n",
                          incorrStrctXML : "incorrStrctXML"
                       });
  // send th email
  var xhr_mail = new XMLHttpRequest();
  xhr_mail.onreadystatechange = function()
  {
    if(xhr_mail.readyState == 4 && xhr_mail.status == 200)
    {
      var message=xhr_mail.responseText;
      console.log(message);
    }
  }
  xhr_mail.open('POST','/custom/corrections/php/sendMailPost.php',true);
	xhr_mail.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	xhr_mail.send(JSON.stringify({"correctionsJSON":correctionsData,"userName":form_name,'userEmail':form_email,'structurePicture':""}));
}



}
function formEncode(obj) {
        var str = [];
        for(var p in obj)
        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        return str.join("&");
}
</script>
